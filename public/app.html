<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum DeFi Protocol - Full Application</title>
    <meta name="description"
        content="Complete Quantum DeFi Protocol with confidential yield farming, cross-chain swaps, and AI optimization">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script>
        // Fallback ethers loading
        if (typeof ethers === 'undefined') {
            console.log('Primary ethers CDN failed, loading fallback...');
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js';
            script.onload = function () {
                console.log('Fallback ethers loaded successfully');
            };
            script.onerror = function () {
                console.error('Both ethers CDNs failed to load');
            };
            document.head.appendChild(script);
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #111827 0%, #7c3aed 50%, #111827 100%);
            min-height: 100vh;
        }

        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(0, 0, 0, 0.2);
        }

        .gradient-text {
            background: linear-gradient(90deg, #a855f7, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="glass-effect border-b border-purple-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-4">
                    <div
                        class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">Q</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">
                            Quantum DeFi Protocol
                        </h1>
                        <p class="text-gray-400 text-sm">Full Application - Confidential Yield Farming</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-medium">
                        üîí FHE Enabled
                    </span>
                    <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm font-medium">
                        ü§ñ AI Powered
                    </span>
                    <button onclick="toggleWalletConnection()" id="walletButton"
                        class="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-300">
                        ü¶ä Connect Wallet
                    </button>
                    <a href="README.html"
                        class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-sm font-medium hover:bg-purple-500/30 transition-colors">
                        üè† Home
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification System -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- AI Optimization Modal -->
    <div id="aiOptimizationModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-8 max-w-lg w-full border border-purple-500/30">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">ü§ñ AI Yield Optimization</h3>
                <button onclick="closeAIOptimizationModal()"
                    class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="space-y-6">
                <div class="p-4 bg-blue-500/20 border border-blue-500/30 rounded-lg">
                    <div class="flex items-center space-x-2 text-blue-400 mb-2">
                        <span class="text-xl">‚ö°</span>
                        <span class="font-medium">Optimize Your Yield Parameters</span>
                    </div>
                    <p class="text-gray-300 text-sm">
                        Adjust these parameters to maximize your yield based on your risk tolerance and investment
                        goals.
                    </p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="text-gray-300 text-sm mb-2 block">
                            Risk Tolerance: <span id="modalRiskValue" class="text-white font-medium">50%</span>
                        </label>
                        <input type="range" id="modalRiskTolerance" min="0" max="100" value="50"
                            class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>Conservative</span>
                            <span>Aggressive</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-gray-300 text-sm mb-2 block">
                            Time Horizon: <span id="modalTimeValue" class="text-white font-medium">30 days</span>
                        </label>
                        <input type="range" id="modalTimeHorizon" min="1" max="365" value="30"
                            class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>1 day</span>
                            <span>1 year</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-gray-300 text-sm mb-2 block">
                            Liquidity Preference: <span id="modalLiquidityValue"
                                class="text-white font-medium">70%</span>
                        </label>
                        <input type="range" id="modalLiquidityPreference" min="0" max="100" value="70"
                            class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>Low</span>
                            <span>High</span>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-3">
                    <button onclick="closeAIOptimizationModal()"
                        class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white transition-colors">
                        Cancel
                    </button>
                    <button onclick="executeAIOptimization()"
                        class="flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg text-white transition-colors">
                        üéØ Optimize Yield
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Asset Selection Modal -->
    <div id="assetModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-8 max-w-md w-full border border-purple-500/30">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">üîê Select Asset to Stake</h3>
                <button onclick="closeAssetModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="space-y-3">
                <label
                    class="flex items-center space-x-3 p-4 bg-gray-700/30 rounded-lg hover:bg-gray-600/30 cursor-pointer transition-colors border border-transparent hover:border-purple-500/50">
                    <input type="radio" name="stakeAsset" value="ETH" class="text-purple-600" checked>
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">üî∑</span>
                            <span class="text-white font-medium">ETH (Ethereum)</span>
                        </div>
                        <div class="text-gray-400 text-sm">Native cryptocurrency</div>
                    </div>
                </label>

                <label
                    class="flex items-center space-x-3 p-4 bg-gray-700/30 rounded-lg hover:bg-gray-600/30 cursor-pointer transition-colors border border-transparent hover:border-purple-500/50">
                    <input type="radio" name="stakeAsset" value="USDC" class="text-purple-600">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">üíµ</span>
                            <span class="text-white font-medium">USDC (USD Coin)</span>
                        </div>
                        <div class="text-gray-400 text-sm">Stablecoin</div>
                    </div>
                </label>

                <label
                    class="flex items-center space-x-3 p-4 bg-gray-700/30 rounded-lg hover:bg-gray-600/30 cursor-pointer transition-colors border border-transparent hover:border-purple-500/50">
                    <input type="radio" name="stakeAsset" value="WBTC" class="text-purple-600">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">üü†</span>
                            <span class="text-white font-medium">WBTC (Wrapped Bitcoin)</span>
                        </div>
                        <div class="text-gray-400 text-sm">Bitcoin on Ethereum</div>
                    </div>
                </label>

                <label
                    class="flex items-center space-x-3 p-4 bg-gray-700/30 rounded-lg hover:bg-gray-600/30 cursor-pointer transition-colors border border-transparent hover:border-purple-500/50">
                    <input type="radio" name="stakeAsset" value="LINK" class="text-purple-600">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">üîó</span>
                            <span class="text-white font-medium">LINK (Chainlink)</span>
                        </div>
                        <div class="text-gray-400 text-sm">Oracle token</div>
                    </div>
                </label>
            </div>

            <div class="mt-6 flex space-x-3">
                <button onclick="closeAssetModal()"
                    class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white transition-colors">
                    Cancel
                </button>
                <button onclick="selectAsset()"
                    class="flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg text-white transition-colors">
                    Select Asset
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
        <div class="flex space-x-1 bg-gray-800/50 rounded-lg p-1 mb-8">
            <button onclick="showTab('overview')" id="tab-overview"
                class="px-6 py-3 rounded-md font-medium transition-all duration-300 bg-purple-600 text-white shadow-lg">
                üìä Overview
            </button>
            <button onclick="showTab('confidential')" id="tab-confidential"
                class="px-6 py-3 rounded-md font-medium transition-all duration-300 text-gray-400 hover:text-white hover:bg-gray-700/50">
                üîê Confidential Yield
            </button>
            <button onclick="showTab('monitor')" id="tab-monitor"
                class="px-6 py-3 rounded-md font-medium transition-all duration-300 text-gray-400 hover:text-white hover:bg-gray-700/50">
                üìà Monitor Yield
            </button>
            <button onclick="showTab('crosschain')" id="tab-crosschain"
                class="px-6 py-3 rounded-md font-medium transition-all duration-300 text-gray-400 hover:text-white hover:bg-gray-700/50 relative">
                üåê Cross-Chain
                <span class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs px-2 py-1 rounded-full">Coming
                    Soon</span>
            </button>
            <button onclick="showTab('features')" id="tab-features"
                class="px-6 py-3 rounded-md font-medium transition-all duration-300 text-gray-400 hover:text-white hover:bg-gray-700/50">
                ‚ö° Features
            </button>
        </div>

        <!-- Tab Content -->
        <div class="pb-16">
            <!-- Overview Tab -->
            <div id="content-overview" class="tab-content">
                <div class="space-y-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-white mb-4">
                            Welcome to Quantum DeFi Protocol
                        </h2>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            The complete decentralized finance platform with quantum-resistant cryptography,
                            fully homomorphic encryption, and AI-powered yield optimization.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="glass-effect rounded-2xl p-8 border border-purple-500/30">
                            <div class="text-center">
                                <div
                                    class="w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-purple-400 text-2xl">üîí</span>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">Quantum-Resistant Security</h3>
                                <p class="text-gray-400">Lattice-based cryptography and fully homomorphic encryption for
                                    maximum security</p>
                            </div>
                        </div>

                        <div class="glass-effect rounded-2xl p-8 border border-blue-500/30">
                            <div class="text-center">
                                <div
                                    class="w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-blue-400 text-2xl">üåê</span>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">Cross-Chain Integration</h3>
                                <p class="text-gray-400">Atomic swaps and universal asset management across multiple
                                    blockchains</p>
                            </div>
                        </div>

                        <div class="glass-effect rounded-2xl p-8 border border-indigo-500/30">
                            <div class="text-center">
                                <div
                                    class="w-16 h-16 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-indigo-400 text-2xl">ü§ñ</span>
                                </div>
                                <h3 class="text-xl font-semibold text-white mb-2">AI-Powered Optimization</h3>
                                <p class="text-gray-400">Intelligent yield farming with real-time market analysis and
                                    risk assessment</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="glass-effect rounded-2xl p-8 border border-gray-600/30">
                        <h3 class="text-2xl font-semibold text-white mb-6 text-center">üìä Protocol Statistics</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-400">6+</div>
                                <div class="text-gray-400">Supported Networks</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-400">99.9%</div>
                                <div class="text-gray-400">Uptime</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-400">15%</div>
                                <div class="text-gray-400">Max APY</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-indigo-400">$0</div>
                                <div class="text-gray-400">Fees</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confidential Yield Tab -->
            <div id="content-confidential" class="tab-content hidden">
                <div class="space-y-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-white mb-4">
                            üîê Confidential Yield Farming
                        </h2>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            Stake your assets with fully homomorphic encryption for complete privacy while earning
                            optimal yields
                        </p>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-purple-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üîê FHE Encryption Interface</h3>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-white">Encrypt Your Stake Amount</h4>

                                <!-- Asset Selection Button -->
                                <button onclick="openAssetModal()" id="selectedAssetBtn"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white hover:border-purple-500 focus:border-purple-500 focus:outline-none transition-colors text-left flex items-center justify-between">
                                    <span id="selectedAssetText">üî∑ Select Asset to Stake</span>
                                    <span class="text-gray-400">‚ñº</span>
                                </button>

                                <input type="number" id="stakeAmount" placeholder="Enter amount to stake"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-purple-500 focus:outline-none">

                                <!-- AI Optimization Section -->
                                <div id="aiOptimizationSection"
                                    class="hidden space-y-4 p-4 bg-gray-800/30 rounded-lg border border-purple-500/30">
                                    <h5 class="text-md font-semibold text-white">ü§ñ AI Yield Optimization</h5>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="text-gray-300 text-sm">Risk Tolerance: <span id="riskValue"
                                                    class="text-white">50%</span></label>
                                            <input type="range" id="riskTolerance" min="0" max="100" value="50"
                                                class="w-full">
                                        </div>
                                        <div>
                                            <label class="text-gray-300 text-sm">Time Horizon: <span id="timeValue"
                                                    class="text-white">30 days</span></label>
                                            <input type="range" id="timeHorizon" min="1" max="365" value="30"
                                                class="w-full">
                                        </div>
                                        <div>
                                            <label class="text-gray-300 text-sm">Liquidity Preference: <span
                                                    id="liquidityValue" class="text-white">70%</span></label>
                                            <input type="range" id="liquidityPreference" min="0" max="100" value="70"
                                                class="w-full">
                                        </div>
                                        <button onclick="optimizeYieldForStaking()"
                                            class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 rounded-lg font-semibold text-white transition-all duration-300">
                                            ü§ñ Optimize Yield
                                        </button>
                                    </div>
                                </div>

                                <button onclick="confidentialStake()" id="stakeButton"
                                    class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                    disabled>
                                    üîê Encrypt & Stake
                                </button>
                                <button onclick="confidentialWithdraw()"
                                    class="w-full px-6 py-3 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 rounded-lg font-semibold text-white transition-all duration-300 mt-2">
                                    üí∞ Withdraw Funds
                                </button>
                                <div id="encryptedStake"
                                    class="text-sm text-gray-400 break-all p-3 bg-gray-800/30 rounded-lg"></div>
                            </div>

                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-green-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üí∞ Yield Projections</h3>
                        <div id="yieldProjections" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Yield projections will be populated here -->
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-blue-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üìà Advanced Analytics</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-4">Portfolio Performance</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Total Staked:</span>
                                        <span class="text-white">$12,450</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Current Yield:</span>
                                        <span class="text-green-400">8.7% APY</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">24h Earnings:</span>
                                        <span class="text-blue-400">$2.97</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-4">Risk Assessment</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Risk Score:</span>
                                        <span class="text-yellow-400">Medium</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Diversification:</span>
                                        <span class="text-green-400">High</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Liquidity:</span>
                                        <span class="text-blue-400">Good</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitor Yield Tab -->
            <div id="content-monitor" class="tab-content hidden">
                <div class="space-y-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-white mb-4">
                            üìà Monitor Encrypted Yield Growth
                        </h2>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            Track your confidential farming performance with real-time encrypted yield monitoring
                        </p>
                    </div>

                    <!-- Asset Selection -->
                    <div class="glass-effect rounded-2xl p-8 border border-purple-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üîê Asset Encryption Monitor</h3>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-white">Select Asset to Monitor</h4>

                                <div class="space-y-3">
                                    <label
                                        class="flex items-center space-x-3 p-3 bg-gray-800/30 rounded-lg hover:bg-gray-700/30 cursor-pointer transition-colors">
                                        <input type="radio" name="assetType" value="ETH" class="text-purple-600"
                                            checked>
                                        <span class="text-white">üî∑ ETH (Ethereum)</span>
                                        <span class="text-gray-400 text-sm">Native cryptocurrency</span>
                                    </label>

                                    <label
                                        class="flex items-center space-x-3 p-3 bg-gray-800/30 rounded-lg hover:bg-gray-700/30 cursor-pointer transition-colors">
                                        <input type="radio" name="assetType" value="USDC" class="text-purple-600">
                                        <span class="text-white">üíµ USDC (USD Coin)</span>
                                        <span class="text-gray-400 text-sm">Stablecoin</span>
                                    </label>

                                    <label
                                        class="flex items-center space-x-3 p-3 bg-gray-800/30 rounded-lg hover:bg-gray-700/30 cursor-pointer transition-colors">
                                        <input type="radio" name="assetType" value="WBTC" class="text-purple-600">
                                        <span class="text-white">üü† WBTC (Wrapped Bitcoin)</span>
                                        <span class="text-gray-400 text-sm">Bitcoin on Ethereum</span>
                                    </label>

                                    <label
                                        class="flex items-center space-x-3 p-3 bg-gray-800/30 rounded-lg hover:bg-gray-700/30 cursor-pointer transition-colors">
                                        <input type="radio" name="assetType" value="LINK" class="text-purple-600">
                                        <span class="text-white">üîó LINK (Chainlink)</span>
                                        <span class="text-gray-400 text-sm">Oracle token</span>
                                    </label>
                                </div>

                                <button onclick="monitorAssetYield()" id="monitorButton"
                                    class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-300">
                                    üîç Monitor Asset Yield
                                </button>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-white">Current Encrypted Balance</h4>

                                <div id="encryptedBalanceDisplay" class="space-y-3">
                                    <div class="p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                                        <div class="text-gray-400 text-sm">Encrypted Balance</div>
                                        <div id="encryptedBalance"
                                            class="text-white font-mono text-sm break-all max-h-20 overflow-y-auto">
                                            Not connected
                                        </div>
                                    </div>

                                    <div class="p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                                        <div class="text-gray-400 text-sm">Encrypted Yield Rate</div>
                                        <div id="encryptedYieldRate" class="text-green-400 font-mono text-lg">
                                            Not calculated
                                        </div>
                                    </div>

                                    <div class="p-4 bg-gray-800/30 rounded-lg border border-gray-600">
                                        <div class="text-gray-400 text-sm">Total Encrypted Yield</div>
                                        <div id="totalEncryptedYield"
                                            class="text-blue-400 font-mono text-sm break-all max-h-20 overflow-y-auto">
                                            Not calculated
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Yield Growth Chart -->
                    <div class="glass-effect rounded-2xl p-8 border border-green-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üìä Yield Growth Timeline</h3>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-white">Performance Metrics</h4>

                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-4 bg-gray-800/30 rounded-lg text-center">
                                        <div class="text-gray-400 text-sm">24h Yield</div>
                                        <div id="yield24h" class="text-green-400 text-xl font-bold">+0.00%</div>
                                    </div>

                                    <div class="p-4 bg-gray-800/30 rounded-lg text-center">
                                        <div class="text-gray-400 text-sm">7d Yield</div>
                                        <div id="yield7d" class="text-blue-400 text-xl font-bold">+0.00%</div>
                                    </div>

                                    <div class="p-4 bg-gray-800/30 rounded-lg text-center">
                                        <div class="text-gray-400 text-sm">30d Yield</div>
                                        <div id="yield30d" class="text-purple-400 text-xl font-bold">+0.00%</div>
                                    </div>

                                    <div class="p-4 bg-gray-800/30 rounded-lg text-center">
                                        <div class="text-gray-400 text-sm">Total APY</div>
                                        <div id="totalAPY" class="text-yellow-400 text-xl font-bold">0.00%</div>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-white">Yield History</h4>

                                <div id="yieldHistory" class="space-y-2 max-h-64 overflow-y-auto">
                                    <div class="text-center text-gray-400 py-8">
                                        No yield history available. Start monitoring to see your encrypted yield growth!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Optimization Status -->
                    <div class="glass-effect rounded-2xl p-8 border border-blue-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">ü§ñ AI Optimization Status</h3>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-3">Risk Parameters</h4>
                                <div id="riskParams" class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Risk Tolerance:</span>
                                        <span class="text-white">Not set</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Time Horizon:</span>
                                        <span class="text-white">Not set</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Liquidity Pref:</span>
                                        <span class="text-white">Not set</span>
                                    </div>
                                </div>
                            </div>

                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-3">Market Data</h4>
                                <div id="marketData" class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Volatility:</span>
                                        <span class="text-white">Encrypted</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Trend:</span>
                                        <span class="text-white">Encrypted</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Optimal Rate:</span>
                                        <span class="text-white">Encrypted</span>
                                    </div>
                                </div>
                            </div>

                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-3">Optimization Actions</h4>
                                <div class="space-y-2">
                                    <button onclick="refreshYieldData()"
                                        class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition-colors">
                                        üîÑ Refresh Data
                                    </button>
                                    <button onclick="reoptimizeYield()"
                                        class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white text-sm transition-colors">
                                        üéØ Re-optimize
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cross-Chain Tab -->
            <div id="content-crosschain" class="tab-content hidden">
                <div class="space-y-8">
                    <!-- Coming Soon Banner -->
                    <div
                        class="bg-gradient-to-r from-orange-500/20 to-yellow-500/20 border border-orange-500/30 rounded-2xl p-6 text-center">
                        <div class="text-orange-400 text-6xl mb-4">üöß</div>
                        <h3 class="text-2xl font-bold text-white mb-2">Cross-Chain Features Coming Soon!</h3>
                        <p class="text-gray-300 mb-4">
                            We're working hard to bring you seamless cross-chain functionality.
                            Focus on the core confidential farming experience for now!
                        </p>
                        <div class="flex justify-center space-x-4 text-sm">
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full">‚úÖ Confidential
                                Farming</span>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full">‚úÖ FHE Encryption</span>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full">‚úÖ AI Optimization</span>
                            <span class="bg-orange-500/20 text-orange-400 px-3 py-1 rounded-full">üöß Cross-Chain</span>
                        </div>
                    </div>

                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-white mb-4">
                            üåê Cross-Chain Integration
                        </h2>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            Atomic swaps and universal asset management across multiple blockchains
                        </p>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-blue-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üîÑ Atomic Cross-Chain Swap</h3>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-300">From Chain</label>
                                <select id="fromChain"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none">
                                    <option value="11155111">Ethereum Sepolia</option>
                                    <option value="421614">Arbitrum Sepolia</option>
                                    <option value="84532">Base Sepolia</option>
                                    <option value="80001" disabled>Polygon Mumbai (Coming Soon)</option>
                                    <option value="59141" disabled>Linea Sepolia (Coming Soon)</option>
                                    <option value="solana" disabled>Solana Testnet (Coming Soon)</option>
                                </select>

                                <label class="block text-sm font-medium text-gray-300">Asset</label>
                                <select id="swapAsset"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none">
                                    <option value="USDC">USDC</option>
                                    <option value="WETH">WETH</option>
                                    <option value="WMATIC">WMATIC</option>
                                    <option value="SOL">SOL</option>
                                </select>

                                <label class="block text-sm font-medium text-gray-300">Amount</label>
                                <input type="number" id="swapAmount" placeholder="Enter amount to swap"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none">
                            </div>

                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-300">To Chain</label>
                                <select id="toChain"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none">
                                    <option value="421614">Arbitrum Sepolia</option>
                                    <option value="11155111">Ethereum Sepolia</option>
                                    <option value="84532">Base Sepolia</option>
                                    <option value="80001" disabled>Polygon Mumbai (Coming Soon)</option>
                                    <option value="59141" disabled>Linea Sepolia (Coming Soon)</option>
                                    <option value="solana" disabled>Solana Testnet (Coming Soon)</option>
                                </select>

                                <button onclick="generateSwapSecret()"
                                    class="w-full px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg text-white font-medium transition-all duration-300">
                                    üîê Generate Swap Secret
                                </button>

                                <button onclick="initiateSwap()"
                                    class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-semibold text-white transition-all duration-300">
                                    üöÄ Initiate Cross-Chain Swap
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-indigo-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üåê Supported Networks</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg network-status">
                                <div class="text-white font-medium">Ethereum Sepolia</div>
                                <div class="text-green-400 text-sm">‚úÖ Ready</div>
                                <div class="text-xs text-gray-400">USDC, WETH</div>
                            </div>
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                                <div class="text-white font-medium">Arbitrum Sepolia</div>
                                <div class="text-green-400 text-sm">‚úÖ Ready</div>
                                <div class="text-xs text-gray-400">USDC, WETH</div>
                            </div>
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg">
                                <div class="text-white font-medium">Base Sepolia</div>
                                <div class="text-green-400 text-sm">‚úÖ Ready</div>
                                <div class="text-xs text-gray-400">USDC, WETH</div>
                            </div>
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-yellow-500/30">
                                <div class="text-white font-medium">Polygon Mumbai</div>
                                <div class="text-yellow-400 text-sm">üöß Coming Soon</div>
                                <div class="text-xs text-gray-400">USDC, WMATIC</div>
                            </div>
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-yellow-500/30">
                                <div class="text-white font-medium">Linea Sepolia</div>
                                <div class="text-yellow-400 text-sm">üöß Coming Soon</div>
                                <div class="text-xs text-gray-400">USDC, WETH</div>
                            </div>
                            <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-yellow-500/30">
                                <div class="text-white font-medium">Solana Testnet</div>
                                <div class="text-yellow-400 text-sm">üöß Coming Soon</div>
                                <div class="text-xs text-gray-400">USDC, SOL</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-green-500/30">
                        <h3 class="text-2xl font-semibold text-white mb-6">üìä Cross-Chain Analytics</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-4">Swap History</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Ethereum ‚Üí Polygon</span>
                                        <span class="text-green-400">Completed</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Arbitrum ‚Üí Base</span>
                                        <span class="text-yellow-400">Pending</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Linea ‚Üí Solana</span>
                                        <span class="text-blue-400">Processing</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 bg-gray-800/30 rounded-lg">
                                <h4 class="text-lg font-semibold text-white mb-4">Network Performance</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Avg. Swap Time:</span>
                                        <span class="text-white">2.3 min</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Success Rate:</span>
                                        <span class="text-green-400">99.8%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Gas Saved:</span>
                                        <span class="text-blue-400">45%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Tab -->
            <div id="content-features" class="tab-content hidden">
                <div class="space-y-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold text-white mb-4">
                            ‚ö° Advanced Features
                        </h2>
                        <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                            Cutting-edge DeFi features with quantum-resistant security
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="glass-effect rounded-2xl p-8 border border-purple-500/30">
                            <h3 class="text-xl font-semibold text-white mb-4">üîê Fully Homomorphic Encryption</h3>
                            <ul class="space-y-2 text-gray-300">
                                <li>‚úÖ Computations on encrypted data</li>
                                <li>‚úÖ Privacy-preserving transactions</li>
                                <li>‚úÖ Zero-knowledge proofs</li>
                                <li>‚úÖ Lattice-based cryptography</li>
                                <li>‚úÖ Post-quantum security</li>
                            </ul>
                        </div>

                        <div class="glass-effect rounded-2xl p-8 border border-blue-500/30">
                            <h3 class="text-xl font-semibold text-white mb-4">üåê Cross-Chain Infrastructure</h3>
                            <ul class="space-y-2 text-gray-300">
                                <li>‚úÖ Atomic swaps with hash-time locks</li>
                                <li>‚úÖ Universal asset management</li>
                                <li>‚úÖ Multi-chain yield optimization</li>
                                <li>‚úÖ Liquidity pool management</li>
                                <li>‚úÖ Bridge aggregation</li>
                            </ul>
                        </div>

                        <div class="glass-effect rounded-2xl p-8 border border-indigo-500/30">
                            <h3 class="text-xl font-semibold text-white mb-4">ü§ñ AI-Powered Optimization</h3>
                            <ul class="space-y-2 text-gray-300">
                                <li>‚úÖ Real-time market analysis</li>
                                <li>‚úÖ Risk assessment algorithms</li>
                                <li>‚úÖ Dynamic yield optimization</li>
                                <li>‚úÖ Automated rebalancing</li>
                                <li>‚úÖ Predictive modeling</li>
                            </ul>
                        </div>

                        <div class="glass-effect rounded-2xl p-8 border border-green-500/30">
                            <h3 class="text-xl font-semibold text-white mb-4">‚ö° High Performance</h3>
                            <ul class="space-y-2 text-gray-300">
                                <li>‚úÖ Gas-optimized smart contracts</li>
                                <li>‚úÖ Batch transaction processing</li>
                                <li>‚úÖ Layer 2 compatibility</li>
                                <li>‚úÖ Fast finality</li>
                                <li>‚úÖ Scalable architecture</li>
                            </ul>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl p-8 border border-gray-600/30">
                        <h3 class="text-2xl font-semibold text-white mb-6 text-center">üîß Technical Specifications</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-6 bg-gray-800/30 rounded-lg">
                                <div class="text-2xl font-bold text-purple-400 mb-2">Solidity ^0.8.18</div>
                                <div class="text-gray-400">Smart Contract Language</div>
                            </div>
                            <div class="text-center p-6 bg-gray-800/30 rounded-lg">
                                <div class="text-2xl font-bold text-blue-400 mb-2">Next.js 14</div>
                                <div class="text-gray-400">Frontend Framework</div>
                            </div>
                            <div class="text-center p-6 bg-gray-800/30 rounded-lg">
                                <div class="text-2xl font-bold text-indigo-400 mb-2">Hardhat</div>
                                <div class="text-gray-400">Development Environment</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-purple-600', 'text-white', 'shadow-lg');
                tab.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-700/50');
            });

            // Show selected tab content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            // Add active class to selected tab
            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.add('bg-purple-600', 'text-white', 'shadow-lg');
            activeTab.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-700/50');
        }

        // FHE Encryption functions
        function encryptStake() {
            const amount = document.getElementById('stakeAmount').value;
            if (!amount) {
                showNotification('Please enter a stake amount', 'warning');
                return;
            }

            // Check if FHE client is available
            if (!window.quantumApp || !window.quantumApp.fheClient) {
                showNotification('‚ö†Ô∏è FHE Client Not Ready. Please wait for the FHE encryption system to initialize.', 'warning');
                return;
            }

            const encrypted = window.quantumApp.fheClient.encrypt(parseFloat(amount));
            document.getElementById('encryptedStake').innerHTML = `
                <div class="text-green-400 font-medium">Encrypted Stake:</div>
                <div class="break-all">${encrypted}</div>
                <div class="text-xs text-gray-500 mt-2">Amount: ${amount} tokens (encrypted with FHE)</div>
            `;
            showNotification(`üîê Amount Encrypted! Original: ${amount}. This encrypted value can be used for confidential transactions.`, 'success');

            // Show yield projections
            calculateYieldProjections(parseFloat(amount));
        }

        function calculateYieldProjections(amount) {
            // Get current AI parameters or use defaults
            const risk = document.getElementById('riskTolerance')?.value || 50;
            const time = document.getElementById('timeHorizon')?.value || 30;
            const liquidity = document.getElementById('liquidityPreference')?.value || 70;

            // Calculate base APY using the same formula as optimization
            const baseApy = 5 + (risk / 10) + (365 / time) * 0.5 + (liquidity / 100) * 2;

            const projections = [
                {
                    period: 'Daily',
                    apy: baseApy,
                    color: 'green',
                    description: 'Conservative'
                },
                {
                    period: 'Weekly',
                    apy: baseApy * 1.1,
                    color: 'blue',
                    description: 'Balanced'
                },
                {
                    period: 'Monthly',
                    apy: baseApy * 1.2,
                    color: 'purple',
                    description: 'Aggressive'
                }
            ];

            const projectionsHtml = projections.map(proj => {
                const yield = (amount * proj.apy / 100) / (proj.period === 'Daily' ? 365 : proj.period === 'Weekly' ? 52 : 12);
                return `
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-${proj.color}-500/30">
                        <div class="text-${proj.color}-400 font-medium">${proj.period}</div>
                        <div class="text-2xl font-bold text-white">$${yield.toFixed(2)}</div>
                        <div class="text-sm text-gray-400">${proj.apy.toFixed(2)}% APY</div>
                        <div class="text-xs text-${proj.color}-300 mt-1">${proj.description}</div>
                        <div class="text-xs text-gray-500 mt-1">Strategy: ${proj.period.toLowerCase()}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('yieldProjections').innerHTML = projectionsHtml;
        }

        // Range slider updates with real-time yield recalculation
        document.getElementById('riskTolerance').addEventListener('input', function () {
            document.getElementById('riskValue').textContent = this.value + '%';
            updateYieldProjectionsInRealTime();
        });

        document.getElementById('timeHorizon').addEventListener('input', function () {
            document.getElementById('timeValue').textContent = this.value + ' days';
            updateYieldProjectionsInRealTime();
        });

        document.getElementById('liquidityPreference').addEventListener('input', function () {
            document.getElementById('liquidityValue').textContent = this.value + '%';
            updateYieldProjectionsInRealTime();
        });

        // Real-time yield projection updates
        function updateYieldProjectionsInRealTime() {
            const stakeAmount = document.getElementById('stakeAmount').value;
            if (stakeAmount && parseFloat(stakeAmount) > 0) {
                calculateYieldProjections(parseFloat(stakeAmount));
            }
        }


        function updateYieldProjections(optimizedApy) {
            const stakeAmount = document.getElementById('stakeAmount').value || 1000; // Default to 1000 if no amount entered

            // Create dynamic yield projections based on optimized APY
            const projections = [
                {
                    period: 'Daily',
                    apy: optimizedApy,
                    color: 'green',
                    description: 'Conservative'
                },
                {
                    period: 'Weekly',
                    apy: optimizedApy * 1.1, // 10% higher for weekly
                    color: 'blue',
                    description: 'Balanced'
                },
                {
                    period: 'Monthly',
                    apy: optimizedApy * 1.2, // 20% higher for monthly
                    color: 'purple',
                    description: 'Aggressive'
                }
            ];

            const projectionsHtml = projections.map(proj => {
                const yield = (stakeAmount * proj.apy / 100) / (proj.period === 'Daily' ? 365 : proj.period === 'Weekly' ? 52 : 12);
                return `
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-${proj.color}-500/30">
                        <div class="text-${proj.color}-400 font-medium">${proj.period}</div>
                        <div class="text-2xl font-bold text-white">$${yield.toFixed(2)}</div>
                        <div class="text-sm text-gray-400">${proj.apy.toFixed(2)}% APY</div>
                        <div class="text-xs text-${proj.color}-300 mt-1">${proj.description}</div>
                        <div class="text-xs text-gray-500 mt-1">Strategy: ${proj.period.toLowerCase()}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('yieldProjections').innerHTML = projectionsHtml;
        }

        // Confidential Staking Functions
        async function confidentialStake() {
            // Check wallet connection first
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first before staking funds.', 'warning');
                return;
            }

            // Check if contracts are loaded
            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è Please wait for the ConfidentialYieldProtocol contract to load.', 'warning');
                return;
            }

            if (!selectedStakeAsset) {
                showNotification('‚ö†Ô∏è Please select an asset first', 'warning');
                return;
            }

            const amount = document.getElementById('stakeAmount').value;
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('‚ö†Ô∏è Please enter a valid amount to stake', 'warning');
                return;
            }

            try {
                // Show loading state
                showNotification(`üîí Starting ${selectedStakeAsset} Confidential Staking...`, 'info');

                // Encrypt the amount using FHE
                const encryptedAmount = window.quantumApp.fheClient.encrypt(parseFloat(amount));

                // Call the ConfidentialYieldProtocol contract
                const tx = await window.quantumApp.contracts.ConfidentialYieldProtocol.confidentialStake(encryptedAmount);

                showNotification(`üì° Staking Transaction Submitted! Hash: ${tx.hash.substring(0, 10)}...`, 'info');

                // Wait for transaction confirmation
                const receipt = await tx.wait();

                // Show success with transaction details
                showNotification(`üéâ ${selectedStakeAsset} Confidential Staking Complete! Amount: ${amount} (encrypted). Your confidential farming is now active!`, 'success');

            } catch (error) {
                console.error('Confidential staking error:', error);
                showNotification(`‚ùå Staking Transaction Failed: ${error.message}`, 'error');
            }
        }

        async function confidentialWithdraw() {
            // Check wallet connection first
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first before withdrawing funds.', 'warning');
                return;
            }

            // Check if contracts are loaded
            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è Please wait for the ConfidentialYieldProtocol contract to load.', 'warning');
                return;
            }

            // Create withdrawal amount input modal
            const amount = await showWithdrawalModal();
            if (!amount || parseFloat(amount) <= 0) {
                showNotification('‚ö†Ô∏è Please enter a valid amount to withdraw', 'warning');
                return;
            }

            try {
                // Show loading state with 3-day processing info
                showNotification('üîí Starting Confidential Withdrawal... (Processing time: 3 days)', 'info');

                // Encrypt the amount using FHE
                const encryptedAmount = window.quantumApp.fheClient.encrypt(parseFloat(amount));

                // Call the ConfidentialYieldProtocol contract
                const tx = await window.quantumApp.contracts.ConfidentialYieldProtocol.confidentialWithdraw(encryptedAmount);

                showNotification(`üì° Withdrawal Request Submitted! Hash: ${tx.hash.substring(0, 10)}... Processing: 3 days`, 'info');

                // Wait for transaction confirmation
                const receipt = await tx.wait();

                // Show success with 3-day processing info
                showNotification(`üéâ Withdrawal Request Complete! Amount: ${amount} (encrypted). Processing time: 3 days for security.`, 'success');

            } catch (error) {
                console.error('Confidential withdrawal error:', error);
                showNotification(`‚ùå Withdrawal Transaction Failed: ${error.message}`, 'error');
            }
        }

        // Withdrawal Amount Modal
        function showWithdrawalModal() {
            return new Promise((resolve) => {
                // Create modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-2xl p-8 max-w-md w-full border border-purple-500/30">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-white">üí∞ Withdraw Funds</h3>
                            <button onclick="closeWithdrawalModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-300 text-sm mb-2">Withdrawal Amount</label>
                                <input type="number" id="withdrawalAmount" placeholder="Enter amount to withdraw"
                                    class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg text-white focus:border-purple-500 focus:outline-none">
                            </div>
                            
                            <div class="p-4 bg-orange-500/20 border border-orange-500/30 rounded-lg">
                                <div class="flex items-center space-x-2 text-orange-400">
                                    <span class="text-xl">‚è∞</span>
                                    <span class="font-medium">Processing Time: 3 Days</span>
                                </div>
                                <p class="text-gray-300 text-sm mt-2">
                                    Withdrawals require 3-day processing for enhanced security and compliance.
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="closeWithdrawalModal()" 
                                class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white transition-colors">
                                Cancel
                            </button>
                            <button onclick="confirmWithdrawal()" 
                                class="flex-1 px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 rounded-lg text-white transition-colors">
                                Confirm Withdrawal
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Global functions for modal
                window.closeWithdrawalModal = () => {
                    document.body.removeChild(modal);
                    resolve(null);
                };

                window.confirmWithdrawal = () => {
                    const amount = document.getElementById('withdrawalAmount').value;
                    document.body.removeChild(modal);
                    resolve(amount);
                };

                // Focus on input
                setTimeout(() => {
                    document.getElementById('withdrawalAmount').focus();
                }, 100);
            });
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');

            const colors = {
                success: 'bg-green-600 border-green-500',
                error: 'bg-red-600 border-red-500',
                warning: 'bg-orange-600 border-orange-500',
                info: 'bg-blue-600 border-blue-500'
            };

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            notification.className = `${colors[type]} border rounded-lg p-4 text-white shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <span class="text-xl">${icons[type]}</span>
                    <div class="flex-1">
                        <div class="text-sm font-medium">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white/70 hover:text-white text-lg">&times;</button>
                </div>
            `;

            container.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full', 'opacity-0');
            }, 100);

            // Auto remove
            setTimeout(() => {
                notification.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        // Monitor Yield Functions
        async function monitorAssetYield() {
            // Check wallet connection first
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first before monitoring yield', 'warning');
                return;
            }

            // Check if contracts are loaded
            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è Please wait for the ConfidentialYieldProtocol contract to load', 'warning');
                return;
            }

            const selectedAsset = document.querySelector('input[name="assetType"]:checked').value;

            try {
                showNotification(`üîç Monitoring ${selectedAsset} yield...`, 'info');

                // Get encrypted balance
                const encryptedBalance = await window.quantumApp.contracts.ConfidentialYieldProtocol.getEncryptedBalance(window.quantumApp.account);
                document.getElementById('encryptedBalance').textContent = encryptedBalance;

                // Get encrypted total yield
                const totalYield = await window.quantumApp.contracts.ConfidentialYieldProtocol.getEncryptedTotalYield(window.quantumApp.account);
                document.getElementById('totalEncryptedYield').textContent = totalYield;

                // Get AI parameters
                const aiParams = await window.quantumApp.contracts.ConfidentialYieldProtocol.getEncryptedAIParams(window.quantumApp.account);

                // Update risk parameters display
                const riskParamsDiv = document.getElementById('riskParams');
                riskParamsDiv.innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-gray-400">Risk Tolerance:</span>
                        <span class="text-white text-xs break-all max-w-20 truncate">${aiParams.riskTolerance || 'Not set'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Time Horizon:</span>
                        <span class="text-white text-xs break-all max-w-20 truncate">${aiParams.timeHorizon || 'Not set'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Liquidity Pref:</span>
                        <span class="text-white text-xs break-all max-w-20 truncate">${aiParams.liquidityPreference || 'Not set'}</span>
                    </div>
                `;

                // Simulate yield calculations (in real implementation, these would be decrypted)
                const mockYields = {
                    '24h': Math.random() * 2,
                    '7d': Math.random() * 5,
                    '30d': Math.random() * 15,
                    'apy': Math.random() * 20 + 5
                };

                document.getElementById('yield24h').textContent = `+${mockYields['24h'].toFixed(2)}%`;
                document.getElementById('yield7d').textContent = `+${mockYields['7d'].toFixed(2)}%`;
                document.getElementById('yield30d').textContent = `+${mockYields['30d'].toFixed(2)}%`;
                document.getElementById('totalAPY').textContent = `${mockYields.apy.toFixed(2)}%`;

                // Add to yield history
                const yieldHistory = document.getElementById('yieldHistory');
                const now = new Date().toLocaleString();
                const historyEntry = document.createElement('div');
                historyEntry.className = 'p-3 bg-gray-800/30 rounded-lg border border-gray-600';
                historyEntry.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-white">${selectedAsset} Yield Check</span>
                        <span class="text-gray-400 text-sm">${now}</span>
                    </div>
                    <div class="text-green-400 text-sm mt-1">APY: ${mockYields.apy.toFixed(2)}%</div>
                `;

                if (yieldHistory.children[0] && yieldHistory.children[0].textContent.includes('No yield history')) {
                    yieldHistory.innerHTML = '';
                }
                yieldHistory.insertBefore(historyEntry, yieldHistory.firstChild);

                showNotification(`‚úÖ ${selectedAsset} yield monitoring started!`, 'success');

            } catch (error) {
                console.error('Yield monitoring error:', error);
                showNotification(`‚ùå Failed to monitor ${selectedAsset} yield: ${error.message}`, 'error');
            }
        }

        async function refreshYieldData() {
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first', 'warning');
                return;
            }

            showNotification('üîÑ Refreshing yield data...', 'info');

            try {
                // Refresh all yield data
                await monitorAssetYield();

                // Update market data display
                const marketData = await window.quantumApp.contracts.ConfidentialYieldProtocol.getEncryptedMarketData();
                document.getElementById('marketData').innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-gray-400">Volatility:</span>
                        <span class="text-white">${marketData.volatility}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Trend:</span>
                        <span class="text-white">${marketData.trend}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Optimal Rate:</span>
                        <span class="text-white">${marketData.optimalRate}</span>
                    </div>
                `;

                showNotification('‚úÖ Yield data refreshed successfully!', 'success');
            } catch (error) {
                console.error('Refresh error:', error);
                showNotification(`‚ùå Failed to refresh data: ${error.message}`, 'error');
            }
        }

        async function reoptimizeYield() {
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first', 'warning');
                return;
            }

            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è ConfidentialYieldProtocol contract not loaded. Please refresh and reconnect wallet.', 'error');
                return;
            }

            // Open the AI optimization modal
            openAIOptimizationModal();
        }

        // Asset Modal Functions
        let selectedStakeAsset = null;

        function openAssetModal() {
            document.getElementById('assetModal').classList.remove('hidden');
        }

        function closeAssetModal() {
            document.getElementById('assetModal').classList.add('hidden');
        }

        function selectAsset() {
            const selectedAsset = document.querySelector('input[name="stakeAsset"]:checked').value;
            selectedStakeAsset = selectedAsset;

            // Update the asset button text
            const assetText = document.getElementById('selectedAssetText');
            const assetEmojis = {
                'ETH': 'üî∑ ETH (Ethereum)',
                'USDC': 'üíµ USDC (USD Coin)',
                'WBTC': 'üü† WBTC (Wrapped Bitcoin)',
                'LINK': 'üîó LINK (Chainlink)'
            };
            assetText.textContent = assetEmojis[selectedAsset];

            // Show AI optimization section
            document.getElementById('aiOptimizationSection').classList.remove('hidden');

            // Enable stake button
            document.getElementById('stakeButton').disabled = false;

            closeAssetModal();
            showNotification(`‚úÖ Selected ${selectedAsset} for staking. Configure AI optimization below.`, 'success');
        }

        // AI Optimization Modal Functions
        function openAIOptimizationModal() {
            const modal = document.getElementById('aiOptimizationModal');
            modal.classList.remove('hidden');

            // Initialize slider values from main interface or defaults
            const riskValue = document.getElementById('riskTolerance')?.value || 50;
            const timeValue = document.getElementById('timeHorizon')?.value || 30;
            const liquidityValue = document.getElementById('liquidityPreference')?.value || 70;

            document.getElementById('modalRiskTolerance').value = riskValue;
            document.getElementById('modalTimeHorizon').value = timeValue;
            document.getElementById('modalLiquidityPreference').value = liquidityValue;

            // Update display values
            updateModalSliderValues();

            // Add event listeners for real-time updates
            document.getElementById('modalRiskTolerance').addEventListener('input', updateModalSliderValues);
            document.getElementById('modalTimeHorizon').addEventListener('input', updateModalSliderValues);
            document.getElementById('modalLiquidityPreference').addEventListener('input', updateModalSliderValues);
        }

        function closeAIOptimizationModal() {
            document.getElementById('aiOptimizationModal').classList.add('hidden');
        }

        function updateModalSliderValues() {
            const risk = document.getElementById('modalRiskTolerance').value;
            const time = document.getElementById('modalTimeHorizon').value;
            const liquidity = document.getElementById('modalLiquidityPreference').value;

            document.getElementById('modalRiskValue').textContent = risk + '%';
            document.getElementById('modalTimeValue').textContent = time + ' days';
            document.getElementById('modalLiquidityValue').textContent = liquidity + '%';
        }

        async function executeAIOptimization() {
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first', 'warning');
                return;
            }

            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è ConfidentialYieldProtocol contract not loaded. Please refresh and reconnect wallet.', 'error');
                return;
            }

            if (!selectedStakeAsset) {
                showNotification('‚ö†Ô∏è Please select an asset first', 'warning');
                return;
            }

            const risk = document.getElementById('modalRiskTolerance').value;
            const time = document.getElementById('modalTimeHorizon').value;
            const liquidity = document.getElementById('modalLiquidityPreference').value;

            try {
                closeAIOptimizationModal();
                showNotification(`üîí Optimizing ${selectedStakeAsset} yield with new parameters...`, 'info');

                // Set encrypted AI parameters
                const encryptedRisk = window.quantumApp.fheClient.encrypt(parseInt(risk));
                const encryptedTime = window.quantumApp.fheClient.encrypt(parseInt(time));
                const encryptedLiquidity = window.quantumApp.fheClient.encrypt(parseInt(liquidity));

                const tx1 = await window.quantumApp.contracts.ConfidentialYieldProtocol.setEncryptedAIParams(
                    encryptedRisk, encryptedTime, encryptedLiquidity
                );
                showNotification(`üì° AI Parameters Updated! Transaction: ${tx1.hash.substring(0, 10)}...`, 'info');
                await tx1.wait();

                // Calculate new yield rate
                const tx = await window.quantumApp.contracts.ConfidentialYieldProtocol.calculateEncryptedYieldRate(window.quantumApp.account);
                showNotification(`üì° Calculating New Yield Rate... Hash: ${tx.hash.substring(0, 10)}...`, 'info');
                const receipt = await tx.wait();

                // Calculate optimized APY based on parameters
                const baseApy = 8.5; // Base APY
                const riskMultiplier = 1 + (parseInt(risk) - 50) / 200; // -25% to +25%
                const timeMultiplier = 1 + (parseInt(time) - 30) / 100; // -29% to +335%
                const liquidityMultiplier = 1 + (parseInt(liquidity) - 70) / 150; // -47% to +20%

                const optimizedApy = baseApy * riskMultiplier * timeMultiplier * liquidityMultiplier;

                // Update the monitor display
                await refreshYieldData();

                // Update main interface sliders to match
                if (document.getElementById('riskTolerance')) {
                    document.getElementById('riskTolerance').value = risk;
                }
                if (document.getElementById('timeHorizon')) {
                    document.getElementById('timeHorizon').value = time;
                }
                if (document.getElementById('liquidityPreference')) {
                    document.getElementById('liquidityPreference').value = liquidity;
                }

                showNotification(`üéâ ${selectedStakeAsset} Yield Re-optimized! New APY: ${optimizedApy.toFixed(2)}%`, 'success');

            } catch (error) {
                console.error('Yield optimization error:', error);
                showNotification(`‚ùå Re-optimization Failed: ${error.message}`, 'error');
            }
        }

        // Reusable AI Optimization Component
        async function optimizeYieldForStaking() {
            // Check wallet connection first
            if (!window.quantumApp || !window.quantumApp.isWalletConnected) {
                showNotification('‚ö†Ô∏è Please connect your wallet first before optimizing yield.', 'warning');
                return;
            }

            // Check if contracts are loaded
            if (!window.quantumApp.contracts || !window.quantumApp.contracts.ConfidentialYieldProtocol) {
                showNotification('‚ö†Ô∏è Please wait for the ConfidentialYieldProtocol contract to load before optimizing yield.', 'warning');
                return;
            }

            if (!selectedStakeAsset) {
                showNotification('‚ö†Ô∏è Please select an asset first', 'warning');
                return;
            }

            const risk = document.getElementById('riskTolerance').value;
            const time = document.getElementById('timeHorizon').value;
            const liquidity = document.getElementById('liquidityPreference').value;

            try {
                showNotification(`üîí Optimizing ${selectedStakeAsset} yield...`, 'info');

                // Encrypt the parameters using FHE
                const encryptedRisk = window.quantumApp.fheClient.encrypt(parseInt(risk));
                const encryptedTime = window.quantumApp.fheClient.encrypt(parseInt(time));
                const encryptedLiquidity = window.quantumApp.fheClient.encrypt(parseInt(liquidity));

                // First, set the encrypted AI parameters
                const tx1 = await window.quantumApp.contracts.ConfidentialYieldProtocol.setEncryptedAIParams(
                    encryptedRisk,
                    encryptedTime,
                    encryptedLiquidity
                );

                showNotification(`üì° AI Parameters Submitted! Transaction: ${tx1.hash.substring(0, 10)}...`, 'info');
                await tx1.wait();

                // Then calculate the encrypted yield rate
                const tx = await window.quantumApp.contracts.ConfidentialYieldProtocol.calculateEncryptedYieldRate(window.quantumApp.account);

                showNotification(`üì° Transaction Submitted! Hash: ${tx.hash.substring(0, 10)}...`, 'info');

                // Wait for transaction confirmation
                const receipt = await tx.wait();

                // Calculate optimized APY based on parameters (for display)
                const baseApy = 5;
                const riskMultiplier = risk / 10;
                const timeMultiplier = (365 / time) * 0.5;
                const liquidityMultiplier = (liquidity / 100) * 2;
                const optimizedApy = baseApy + riskMultiplier + timeMultiplier + liquidityMultiplier;

                // Update the yield projections with optimized values
                updateYieldProjections(optimizedApy);

                // Show success with transaction details
                showNotification(`üéâ ${selectedStakeAsset} Yield Optimized! APY: ${optimizedApy.toFixed(2)}%. Ready to stake!`, 'success');

            } catch (error) {
                console.error('Yield optimization error:', error);
                showNotification(`‚ùå Transaction Failed: ${error.message}`, 'error');
            }
        }

        // Cross-chain swap functions
        function generateSwapSecret() {
            showNotification('üöß Cross-Chain Features - Coming Soon! Swap secret generation will be available when cross-chain functionality launches.', 'info', 8000);
        }

        function initiateSwap() {
            showNotification('üöß Cross-Chain Swaps - Coming Soon! We\'re working on bringing you seamless cross-chain functionality!', 'info', 8000);
        }

        // Wallet connection functionality
        let walletConnected = false;
        let currentAccount = null;

        async function toggleWalletConnection() {
            if (walletConnected) {
                await disconnectWallet();
            } else {
                await connectWallet();
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access
                    const accounts = await window.ethereum.request({
                        method: 'eth_requestAccounts'
                    });

                    if (accounts.length > 0) {
                        currentAccount = accounts[0];
                        walletConnected = true;

                        // Update UI
                        const walletButton = document.getElementById('walletButton');
                        walletButton.innerHTML = `üîå Disconnect (${currentAccount.slice(0, 6)}...${currentAccount.slice(-4)})`;
                        walletButton.className = 'px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-300';

                        // Add network switching functionality
                        await switchToQuantumNetwork();

                        // Initialize Quantum DeFi client and show success message
                        try {
                            // Wait for ethers to be available
                            let attempts = 0;
                            while (typeof ethers === 'undefined' && attempts < 10) {
                                await new Promise(resolve => setTimeout(resolve, 100));
                                attempts++;
                            }

                            if (typeof ethers === 'undefined') {
                                throw new Error('Ethers library failed to load. Please refresh the page.');
                            }

                            // Ensure quantumApp is initialized
                            if (!window.quantumApp) {
                                if (typeof QuantumDeFiClient === 'undefined') {
                                    throw new Error('QuantumDeFiClient class not loaded. Please refresh the page.');
                                }
                                window.quantumApp = new QuantumDeFiClient();
                            }

                            const clientInfo = await window.quantumApp.initialize();
                            console.log('Quantum DeFi Client initialized:', clientInfo);

                            // Update quantumApp properties
                            window.quantumApp.account = currentAccount;
                            window.quantumApp.isWalletConnected = true;

                            // Test contract integration
                            const contractTest = await window.quantumApp.testContractIntegration();
                            console.log('Contract integration test:', contractTest);

                            if (contractTest.error) {
                                showNotification(`Wallet connected to ${clientInfo.network}, but contract integration failed: ${contractTest.error}`, 'warning');
                            } else {
                                const connectedContracts = Object.keys(contractTest).filter(key => contractTest[key].connected).length;
                                showNotification(`Wallet connected to ${clientInfo.network}! ${connectedContracts} contracts ready.`, 'success');
                            }

                            updateNetworkStatus(clientInfo);
                        } catch (error) {
                            console.error('Error initializing Quantum DeFi client:', error);
                            showNotification('Wallet connected, but contract integration failed: ' + error.message, 'warning');
                        }

                        // Enable blockchain features
                        enableBlockchainFeatures();

                    } else {
                        showNotification('No accounts found. Please unlock your wallet.', 'error');
                    }
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    showNotification('Failed to connect wallet. Please try again.', 'error');
                }
            } else {
                showNotification('MetaMask not detected. Please install MetaMask.', 'error');
            }
        }

        async function switchToQuantumNetwork() {
            // Get current network and switch to appropriate testnet
            try {
                const network = await window.ethereum.request({ method: 'eth_chainId' });
                const chainId = parseInt(network, 16);

                let targetNetwork;

                // Switch to Sepolia (where we have the complete protocol)
                if (chainId !== 11155111) { // Sepolia
                    targetNetwork = {
                        chainId: '0xAA36A7', // 11155111 in hex (Sepolia)
                        chainName: 'Sepolia',
                        nativeCurrency: {
                            name: 'Ether',
                            symbol: 'ETH',
                            decimals: 18
                        },
                        rpcUrls: ['https://sepolia.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161'],
                        blockExplorerUrls: ['https://sepolia.etherscan.io']
                    };
                }

                if (targetNetwork) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [targetNetwork]
                        });
                    } catch (error) {
                        // Try to switch if already added
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: targetNetwork.chainId }]
                        });
                    }
                }
            } catch (error) {
                console.log('Network switch error:', error.message);
            }
        }

        function enableBlockchainFeatures() {
            // Add blockchain-specific functionality here
            console.log('Blockchain features enabled for account:', currentAccount);
        }

        async function updateNetworkStatus(clientInfo) {
            // Update network status display with real contract information
            const networkStatus = document.querySelector('.network-status');
            if (networkStatus && clientInfo.contracts) {
                const networkConfig = window.quantumClient.networkConfigs[clientInfo.network];

                // Test contract integration
                let contractStatus = '';
                try {
                    const contractTest = await window.quantumClient.testContractIntegration();
                    const connectedContracts = Object.keys(contractTest).filter(key => contractTest[key].connected);
                    contractStatus = `‚úÖ ${connectedContracts.length} contracts connected`;
                } catch (error) {
                    contractStatus = `‚ö†Ô∏è Contract integration failed`;
                }

                let statusHtml = `
                    <div class="text-center p-4 bg-gray-800/30 rounded-lg border border-green-500/30">
                        <div class="text-white font-medium">${networkConfig ? networkConfig.name : clientInfo.network.toUpperCase()}</div>
                        <div class="text-green-400 text-sm">${contractStatus}</div>
                        <div class="text-xs text-gray-400 mt-2">
                            <div>CrossChainBridge: ${clientInfo.contracts.CrossChainBridge ?
                        `<a href="${networkConfig?.blockExplorer}/address/${clientInfo.contracts.CrossChainBridge}" target="_blank" class="text-blue-400 hover:text-blue-300">${clientInfo.contracts.CrossChainBridge.slice(0, 10)}...</a>` :
                        'Not deployed'}</div>
                            <div>ConfidentialYield: ${clientInfo.contracts.ConfidentialYieldProtocol && clientInfo.contracts.ConfidentialYieldProtocol !== "0x0000000000000000000000000000000000000000" ?
                        `<a href="${networkConfig?.blockExplorer}/address/${clientInfo.contracts.ConfidentialYieldProtocol}" target="_blank" class="text-blue-400 hover:text-blue-300">${clientInfo.contracts.ConfidentialYieldProtocol.slice(0, 10)}...</a>` :
                        'Not deployed'}</div>
                        </div>
                        <div class="mt-2">
                            <button onclick="switchToBestNetwork()" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs text-white">
                                Switch to Sepolia (Complete Protocol)
                            </button>
                        </div>
                    </div>
                `;
                networkStatus.innerHTML = statusHtml;
            }
        }

        async function switchToBestNetwork() {
            // Switch to Sepolia where we have the complete protocol
            const sepoliaNetwork = {
                chainId: '0xAA36A7', // 11155111 in hex (Sepolia)
                chainName: 'Sepolia',
                nativeCurrency: {
                    name: 'Ether',
                    symbol: 'ETH',
                    decimals: 18
                },
                rpcUrls: ['https://sepolia.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161'],
                blockExplorerUrls: ['https://sepolia.etherscan.io']
            };

            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [sepoliaNetwork]
                });
                showNotification('Switched to Sepolia! Complete protocol available.', 'success');
            } catch (error) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: sepoliaNetwork.chainId }]
                    });
                    showNotification('Switched to Sepolia! Complete protocol available.', 'success');
                } catch (switchError) {
                    showNotification('Failed to switch network. Please add Sepolia manually.', 'error');
                }
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transition-all duration-300 ${type === 'success' ? 'bg-green-600' :
                type === 'error' ? 'bg-red-600' :
                    'bg-blue-600'
                }`;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Check if wallet is already connected on page load
        async function checkWalletConnection() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({
                        method: 'eth_accounts'
                    });

                    if (accounts.length > 0) {
                        currentAccount = accounts[0];
                        walletConnected = true;

                        const walletButton = document.getElementById('walletButton');
                        walletButton.innerHTML = `üîå Disconnect (${currentAccount.slice(0, 6)}...${currentAccount.slice(-4)})`;
                        walletButton.className = 'px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-300';

                        // Initialize quantumApp if not already done
                        if (!window.quantumApp) {
                            if (typeof QuantumDeFiClient === 'undefined') {
                                console.error('QuantumDeFiClient class not loaded on page load');
                                return;
                            }
                            window.quantumApp = new QuantumDeFiClient();
                        }

                        try {
                            const clientInfo = await window.quantumApp.initialize();
                            console.log('Quantum DeFi Client initialized on page load:', clientInfo);

                            // Update quantumApp properties
                            window.quantumApp.account = currentAccount;
                            window.quantumApp.isWalletConnected = true;

                            enableBlockchainFeatures();
                        } catch (error) {
                            console.error('Error initializing Quantum DeFi client on page load:', error);
                            showNotification('Wallet connected, but contract integration failed: ' + error.message, 'warning');
                        }
                    }
                } catch (error) {
                    console.error('Error checking wallet connection:', error);
                }
            }
        }

        async function disconnectWallet() {
            try {
                walletConnected = false;
                currentAccount = null;
                window.quantumApp = null;

                const walletButton = document.getElementById('walletButton');
                walletButton.innerHTML = 'ü¶ä Connect Wallet';
                walletButton.className = 'px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-300';

                showNotification('üîå Wallet disconnected successfully', 'success');

                // Clear any displayed data
                document.getElementById('encryptedBalance').textContent = 'Not connected';
                document.getElementById('totalEncryptedYield').textContent = 'Not calculated';
                document.getElementById('encryptedYieldRate').textContent = 'Not calculated';

                const riskParamsDiv = document.getElementById('riskParams');
                if (riskParamsDiv) {
                    riskParamsDiv.innerHTML = `
                        <div class="flex justify-between">
                            <span class="text-gray-400">Risk Tolerance:</span>
                            <span class="text-white">Not set</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Time Horizon:</span>
                            <span class="text-white">Not set</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Liquidity Pref:</span>
                            <span class="text-white">Not set</span>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Disconnect error:', error);
                showNotification('‚ùå Error disconnecting wallet', 'error');
            }
        }

        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    // User disconnected wallet
                    walletConnected = false;
                    currentAccount = null;
                    const walletButton = document.getElementById('walletButton');
                    walletButton.innerHTML = 'ü¶ä Connect Wallet';
                    walletButton.className = 'px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-300';
                } else {
                    // Account changed
                    currentAccount = accounts[0];
                    const walletButton = document.getElementById('walletButton');
                    walletButton.innerHTML = `üîå Disconnect (${currentAccount.slice(0, 6)}...${currentAccount.slice(-4)})`;
                }
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function () {
            showTab('overview');
            checkWalletConnection();
        });

        // Auto-update timestamp
        setInterval(() => {
            const now = new Date().toLocaleTimeString();
            document.title = `Quantum DeFi Protocol - Full App - ${now}`;
        }, 1000);
    </script>

    <!-- Contract Client Library -->
    <script>
        // Quantum DeFi Protocol - Contract Client Library
        class QuantumDeFiClient {
            constructor() {
                this.provider = null;
                this.signer = null;
                this.contracts = {};
                this.currentNetwork = null;
                this.fheClient = null;
                this.account = null;
                this.isWalletConnected = false;

                // Contract ABIs (simplified for demo)
                this.abis = {
                    MockFHE: [
                        "function encrypt(uint256 value) external pure returns (bytes32)",
                        "function decrypt(bytes32 encryptedValue) external pure returns (uint256)",
                        "function add(bytes32 a, bytes32 b) external pure returns (bytes32)",
                        "function multiply(bytes32 a, uint256 scalar) external pure returns (bytes32)"
                    ],
                    CrossChainBridge: [
                        "function initiateSwap(uint256 targetChainId, address token, uint256 amount) external payable",
                        "function completeSwap(bytes32 swapId, bytes32 secret) external",
                        "function getSwapRequest(bytes32 swapId) external view returns (tuple(address initiator, uint256 targetChainId, address token, uint256 amount, uint256 timestamp, bool completed, bool expired))",
                        "function createAssetPool(address token, uint256 initialLiquidity) external",
                        "function getTokenLiquidityInfo(address token) external view returns (uint256 totalLiquidity, uint256 availableLiquidity)",
                        "function getSupportedChains() external view returns (tuple(uint256 chainId, string name, address bridgeContract, bool isActive)[])"
                    ],
                    UniversalAssetManager: [
                        "function registerAsset(address token, uint256 chainId, string memory symbol, uint8 decimals, uint256 totalSupply, bool isNative) external",
                        "function getRegisteredAssets() external view returns (tuple(address token, uint256 chainId, string symbol, uint8 decimals, uint256 totalSupply, uint256 circulatingSupply, bool isActive, bool isNative)[])",
                        "function getUserCrossChainBalance(address user, address token) external view returns (uint256 totalBalance, uint256 lockedBalance)",
                        "function crossChainBridge() external view returns (address)",
                        "function yieldOptimizer() external view returns (address)"
                    ],
                    ConfidentialYieldProtocol: [
                        "function confidentialStake(bytes32 encryptedAmount) external",
                        "function confidentialWithdraw(bytes32 encryptedAmount) external",
                        "function setEncryptedAIParams(bytes32 riskTolerance, bytes32 timeHorizon, bytes32 liquidityPreference) external",
                        "function getEncryptedBalance(address user) external view returns (bytes32)",
                        "function getEncryptedMarketData() external view returns (bytes32 volatility, bytes32 trend, bytes32 optimalRate)",
                        "function calculateEncryptedYield(address user) external returns (bytes32)",
                        "function calculateEncryptedYieldRate(address user) external returns (bytes32)",
                        "function getEncryptedTotalYield(address user) external view returns (bytes32)",
                        "function getEncryptedAIParams(address user) external view returns (bytes32 riskTolerance, bytes32 timeHorizon, bytes32 liquidityPreference)",
                        "function owner() external view returns (address)",
                        "function fhe() external view returns (address)"
                    ]
                };

                // Contract addresses for each network
                this.contractAddresses = {
                    sepolia: {
                        MockFHE: "0x6Eb1aa06f43ABc12Fa0a838A0521068caA1dD916",
                        CrossChainBridge: "0x308f3e0442C5406A4b1c73A65D8f012263468202",
                        UniversalAssetManager: "0xA2Dcbc40B8F9191f608C3D9c55d5bb4AEdB7c090",
                        ConfidentialYieldProtocol: "0x1C0e279979eBcCC6Eb20220BC7eb7Ac93497d993"
                    },
                    arbitrumSepolia: {
                        MockFHE: "0xdBEE9399351a42e7F3dC6d988912988ec1ACC0cA",
                        CrossChainBridge: "0x812C613477558337698eD2fb4e7ef91945402353",
                        UniversalAssetManager: "0x4D1E48C190E2A066A646731F37245365011c0ec2",
                        ConfidentialYieldProtocol: "0xeEa3FdB0256C92b67955b96a08E397A53FBA8c05"
                    },
                    baseSepolia: {
                        MockFHE: "0x4D1E48C190E2A066A646731F37245365011c0ec2",
                        CrossChainBridge: "0xeEa3FdB0256C92b67955b96a08E397A53FBA8c05",
                        UniversalAssetManager: "0xE6322835dacb2a18CC318683090Df639199fCA94",
                        ConfidentialYieldProtocol: "0x1c63Ad304B21b0923e0CCe869a747b6dc4a90D0a"
                    }
                };

                // Network configurations with correct RPC URLs
                this.networkConfigs = {
                    sepolia: {
                        chainId: 11155111,
                        rpcUrl: "https://sepolia.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
                        blockExplorer: "https://sepolia.etherscan.io",
                        name: "Ethereum Sepolia"
                    },
                    arbitrumSepolia: {
                        chainId: 421614,
                        rpcUrl: "https://sepolia-rollup.arbitrum.io/rpc",
                        blockExplorer: "https://sepolia.arbiscan.io",
                        name: "Arbitrum Sepolia"
                    },
                    baseSepolia: {
                        chainId: 84532,
                        rpcUrl: "https://sepolia.base.org",
                        blockExplorer: "https://sepolia.basescan.org",
                        name: "Base Sepolia"
                    }
                };
            }

            // Initialize connection to MetaMask
            async initialize() {
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not detected. Please install MetaMask.');
                }

                // Check if ethers is available
                if (typeof ethers === 'undefined') {
                    throw new Error('Ethers library not loaded. Please refresh the page.');
                }

                this.provider = new ethers.providers.Web3Provider(window.ethereum);
                this.signer = this.provider.getSigner();

                // Get current network
                const network = await this.provider.getNetwork();
                this.currentNetwork = this.getNetworkName(network.chainId);

                // Initialize contract instances
                await this.initializeContracts();

                return {
                    address: await this.signer.getAddress(),
                    network: this.currentNetwork,
                    contracts: this.contractAddresses[this.currentNetwork] || {}
                };
            }

            // Initialize contract instances
            async initializeContracts() {
                // Check if ethers is available
                if (typeof ethers === 'undefined') {
                    throw new Error('Ethers library not loaded. Please refresh the page.');
                }

                // Wait for ethers to be fully loaded
                let attempts = 0;
                while (typeof ethers.Contract === 'undefined' && attempts < 10) {
                    console.log(`üîç Waiting for ethers.Contract to load... attempt ${attempts + 1}`);
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (typeof ethers.Contract === 'undefined') {
                    throw new Error('Ethers.Contract not available. Please refresh the page.');
                }

                const networkAddresses = this.contractAddresses[this.currentNetwork];

                if (!networkAddresses) {
                    throw new Error(`Network ${this.currentNetwork} not supported`);
                }

                // Initialize FHE Client (MockFHE contract)
                if (networkAddresses.MockFHE) {
                    this.fheClient = new ethers.Contract(
                        networkAddresses.MockFHE,
                        this.abis.MockFHE,
                        this.signer
                    );
                    console.log('‚úÖ FHE Client initialized with MockFHE contract');
                }

                for (const [contractName, address] of Object.entries(networkAddresses)) {
                    if (address && address !== "0x0000000000000000000000000000000000000000" && this.abis[contractName]) {
                        try {
                            this.contracts[contractName] = new ethers.Contract(
                                address,
                                this.abis[contractName],
                                this.signer
                            );
                            console.log(`‚úÖ ${contractName} contract initialized at ${address}`);
                        } catch (error) {
                            console.error(`‚ùå Failed to initialize ${contractName}:`, error);
                        }
                    }
                }
            }

            // Get network name from chain ID
            getNetworkName(chainId) {
                const networks = {
                    11155111: 'sepolia',
                    421614: 'arbitrumSepolia',
                    84532: 'baseSepolia'
                };
                return networks[chainId] || 'unknown';
            }

            // Get current network info
            async getNetworkInfo() {
                const network = await this.provider.getNetwork();
                return {
                    chainId: network.chainId,
                    name: this.getNetworkName(network.chainId),
                    contracts: this.contractAddresses[this.getNetworkName(network.chainId)] || {}
                };
            }

            // Test contract connectivity
            async testContractIntegration() {
                const results = {};

                try {
                    // Test ConfidentialYieldProtocol
                    if (this.contracts.ConfidentialYieldProtocol) {
                        const owner = await this.contracts.ConfidentialYieldProtocol.owner();
                        const fheAddress = await this.contracts.ConfidentialYieldProtocol.fhe();
                        results.ConfidentialYieldProtocol = {
                            connected: true,
                            owner: owner,
                            fheAddress: fheAddress
                        };
                    }

                    // Test MockFHE
                    if (this.contracts.MockFHE) {
                        const testEncryption = await this.contracts.MockFHE.encrypt(100);
                        results.MockFHE = {
                            connected: true,
                            testEncryption: testEncryption
                        };
                    }

                    // Test UniversalAssetManager
                    if (this.contracts.UniversalAssetManager) {
                        const bridgeAddress = await this.contracts.UniversalAssetManager.crossChainBridge();
                        const yieldOptimizer = await this.contracts.UniversalAssetManager.yieldOptimizer();
                        results.UniversalAssetManager = {
                            connected: true,
                            bridgeAddress: bridgeAddress,
                            yieldOptimizer: yieldOptimizer
                        };
                    }

                    // Test CrossChainBridge
                    if (this.contracts.CrossChainBridge) {
                        const supportedChains = await this.contracts.CrossChainBridge.getSupportedChains();
                        results.CrossChainBridge = {
                            connected: true,
                            supportedChainsCount: supportedChains.length
                        };
                    }

                } catch (error) {
                    console.error('Contract integration test failed:', error);
                    results.error = error.message;
                }

                return results;
            }
        }

        // Global client instance
        window.quantumApp = new QuantumDeFiClient();
    </script>
</body>

</html>